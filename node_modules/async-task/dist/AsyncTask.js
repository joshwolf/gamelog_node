!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.AsyncTask=e()}}(function(){var define,module,exports;return function e(r,t,n){function o(s,a){if(!t[s]){if(!r[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=t[s]={exports:{}};r[s][0].call(u.exports,function(e){var t=r[s][1][e];return o(t?t:e)},u,u.exports,e,r,t,n)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e,r,t){"use strict";r.exports=e("./src/AsyncTask")},{"./src/AsyncTask":8}],2:[function(e,r,t){r.exports=e("./src/BackgroundWorker")},{"./src/BackgroundWorker":3}],3:[function(_dereq_,module,exports){(function(__dirname){"use strict";function BackgroundWorker(e){e=e?e:{},this.importScripts=e.importScripts||[],this.definitions=e.definitions||[],this.domain=e.domain||!isNode?location.protocol+"//"+location.host:null,this._spec=e,this._worker=null,this._iframe=null,this._messageId=0,this._messagehandlers={},this._state=BackgroundWorker.CREATED,"function"==typeof e&&this.define("default",e)}function start(e){if(e._isStarted)throw new Error("cannot start allready started BackgroundWorker");return e._isStarted=!0,isNode?setupChildProcess(e):BackgroundWorker.hasWorkerSupport()?setupWebWorker(e):setupIframe(e),stateChange(e,BackgroundWorker.IDLE),e}function postMessage(e,r,t){isNode?e._childProcess.send(r):BackgroundWorker.hasWorkerSupport()?e._worker.postMessage(r):e._iframe.contentWindow.postMessage(r,t)}function setupWebWorker(e){e.blob=new Blob([getWorkerSourcecode(e)],{type:"text/javascript"}),e._worker=new Worker(window.URL.createObjectURL(e.blob)),e._worker.onmessage=function(r){return workerOnMessageHandler(e,r)},e._worker.onerror=function(r){return workerOnErrorHandler(e,r)}}function setupChildProcess(e){e._childProcess=child_process.fork(__dirname+"/nodeworker.js");for(var r=0;r<e.definitions.length;r++)"function"==typeof e.definitions[r].val&&(e.definitions[r].val=e.definitions[r].val.toString()),e._childProcess.send({command:"define",args:[e.definitions[r]],messageId:getUniqueMessageId(e)});e._childProcess.on("message",function(r){childProcessOnMessageHandler(e,r)})}function setupIframe(e){var r,t;e._iframe=document.createElement("iframe"),r=document.createElement("script"),e._iframe.style||(e._iframe.style={}),e._iframe.style.display="none",t="",t+="var domain = '"+e.domain+"';\n",t+="var importScripts = "+JSON.stringify(e.importScripts)+";\n",t+="var definitions = {};\n";for(var n=0;n<e.definitions.length;n++)t+=" definitions['"+e.definitions[n].key+"'] = "+e.definitions[n].val+";\n";t+=";("+function(){function r(e){function r(){var n=importScripts.shift();if(t||!n)return t=!0,e();var o=document.createElement("script");o.onload=function(){r()},document.body.appendChild(o),o.src=n}var t=!1;r()}e.onmessage=function(e){var t=e.data;r(function(){try{var e=definitions[t.command].apply(this,t.args),r={messageId:t.messageId,result:e};postMessage(r,domain)}catch(n){var o={messageId:t.messageId,exception:{type:n.name,message:n.message}};postMessage(o,domain)}})}}.toString()+")();\n",r.innerHTML=t,window.document.body.appendChild(e._iframe),e._iframe.contentWindow.addEventListener("message",function(r){return iframeOnMessageHandler(e,r)}),e._iframe.contentDocument.body.appendChild(r)}function getUniqueMessageId(e){return e._messageId++}function stateChange(e,r){var t;return t=e._state,e._state=r,t!==r}function workerOnMessageHandler(e,r){var t,n;return t=r.data,n=e._messagehandlers[t.messageId],t.exception?n.reject(createExceptionFromMessage(e,t.exception)):void n.resolve(t.result)}function childProcessOnMessageHandler(e,r){var t,n;return t=r,n=e._messagehandlers[t.messageId],t.exception?n.reject(createExceptionFromMessage(e,t.exception)):void n.resolve(t.result)}function iframeOnMessageHandler(e,r){var t,n;return t=r.data,t.command?null:(n=e._messagehandlers[t.messageId],t.exception?n.reject(createExceptionFromMessage(e,t.exception)):void n.resolve(t.result))}function createExceptionFromMessage(self,exception){var type,message;try{type=isNode?eval(exception.type):"function"==typeof global[exception.type]?global[exception.type]:Error}catch(exception){type=Error}return message=exception.message,new type(message)}function memoize(e){var r={},t=r;return function(){return t!==r?t:t=e.apply(null,arguments)}}function workerOnErrorHandler(e,r){var t,n,o,i;r.preventDefault(),t=r.message,n=t.match(/Uncaught\s([a-zA-Z]+)\:(.*)/);try{o="function"==typeof global[n[1]]?global[n[1]]:Error,i="function"==typeof global[n[1]]?n[2]:t}catch(s){o=Error,i=t}n=new o(i),e.emit("exception",n)}function getWorkerSourcecode(e){var r;r="",e.importScripts.length&&(r+="importScripts( '"+e.importScripts.join("','")+"' );\n"),r+=" var definitions = {};";for(var t=0;t<e.definitions.length;t++)r+=" definitions['"+e.definitions[t].key+"'] = "+e.definitions[t].val+";\n";return r+="self.onmessage = function( event ) { try {var data = event.data;var result = definitions[data.command].apply(this, data.args);var out = { messageId: data.messageId, result: result };this.postMessage( out );}catch( exception ) {var message = { messageId: data.messageId, exception: { type: exception.name, message: exception.message } };this.postMessage(message);}};"}var child_process=_dereq_("child_process"),isNode=_dereq_("detect-node");module.exports=BackgroundWorker,BackgroundWorker.hasWorkerSupport=function(){return"undefined"!=typeof window.Worker&&"undefined"!=typeof window.Blob&&"function"==typeof window.URL.createObjectURL},BackgroundWorker.hasStructuredCloneSupport=memoize(function(){try{return window.postMessage(document.createElement("a"),"*"),!0}catch(e){return!e.DATA_CLONE_ERR}}),BackgroundWorker.CREATED={},BackgroundWorker.RUNNING={},BackgroundWorker.IDLE={},BackgroundWorker.TERMINATED={},BackgroundWorker.prototype.define=function(e,r){this.definitions.push({key:e,val:r})},BackgroundWorker.prototype.run=function(e,r){var t,n,o,i,s;if(t=this,"string"!=typeof e&&(e="default",r=Array.prototype.slice.call(t)),t._state===BackgroundWorker.TERMINATED)throw new Error("Cannot call run on a Terminated BackgroundWorker");return t._isStarted||start(t),stateChange(t,BackgroundWorker.RUNNING),n=getUniqueMessageId(t),o={command:e,args:r,messageId:n},i={},s=new Promise(function(e,r){function n(e){return function(){stateChange(t,BackgroundWorker.IDLE),e.apply(t,arguments)}}i.resolve=n(e),i.reject=n(r)}),t._messagehandlers[n]=i,postMessage(t,o,t.domain),s},BackgroundWorker.prototype.terminate=function(){var e;e=this,isNode?e._childProcess&&e._childProcess.kill():BackgroundWorker.hasWorkerSupport()?e._worker&&e._worker.terminate():e._iframe&&e._iframe.remove(),stateChange(e,BackgroundWorker.TERMINATED)},BackgroundWorker.prototype._start=function(){return start(this)};var global="undefined"!=typeof global?global:"undefined"!=typeof window?window:this}).call(this,"/node_modules/background-worker/src")},{child_process:4,"detect-node":5}],4:[function(e,r,t){},{}],5:[function(e,r,t){(function(e){r.exports=!1;try{r.exports="[object process]"===Object.prototype.toString.call(e.process)}catch(t){}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,r,t){(function(e){var t;if(e.crypto&&crypto.getRandomValues){var n=new Uint8Array(16);t=function(){return crypto.getRandomValues(n),n}}if(!t){var o=new Array(16);t=function(){for(var e,r=0;16>r;r++)0===(3&r)&&(e=4294967296*Math.random()),o[r]=e>>>((3&r)<<3)&255;return o}}r.exports=t}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,r,t){function n(e,r,t){var n=r&&t||0,o=0;for(r=r||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>o&&(r[n+o++]=u[e])});16>o;)r[n+o++]=0;return r}function o(e,r){var t=r||0,n=c;return n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]}function i(e,r,t){var n=r&&t||0,i=r||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:l,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:m+1,u=a-g+(c-m)/1e4;if(0>u&&void 0===e.clockseq&&(s=s+1&16383),(0>u||a>g)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=a,m=c,l=s,a+=122192928e5;var d=(1e4*(268435455&a)+c)%4294967296;i[n++]=d>>>24&255,i[n++]=d>>>16&255,i[n++]=d>>>8&255,i[n++]=255&d;var f=a/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=255&f,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=s>>>8|128,i[n++]=255&s;for(var h=e.node||p,k=0;6>k;k++)i[n+k]=h[k];return r?r:o(i)}function s(e,r,t){var n=r&&t||0;"string"==typeof e&&(r="binary"==e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,r)for(var s=0;16>s;s++)r[n+s]=i[s];return r||o(i)}for(var a=e("./rng"),c=[],u={},d=0;256>d;d++)c[d]=(d+256).toString(16).substr(1),u[c[d]]=d;var f=a(),p=[1|f[0],f[1],f[2],f[3],f[4],f[5]],l=16383&(f[6]<<8|f[7]),g=0,m=0,h=s;h.v1=i,h.v4=s,h.parse=n,h.unparse=o,r.exports=h},{"./rng":6}],8:[function(e,r,t){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),a=e("background-worker"),c=n(a),u=e("uuid"),d=n(u),f=Array.prototype.slice,p=function(){function e(r,t){o(this,e),"object"===("undefined"==typeof r?"undefined":i(r))&&(t=r,r=t.doInBackground),this._options="object"===("undefined"==typeof t?"undefined":i(t))?t:{},this.__uuid=d["default"].v4(),this.__hasExecuted=!1,this.__keepAlive=this._options.keepAlive,this.__sharingworker=!1,this.doInBackground=r,this.importScripts=this._options.importScripts?this._options.importScripts:[],"function"!=typeof this.doInBackground&&console.warn("AsyncTask["+this.__uuid+"].doInBackground is not function",this),this._options.worker&&(this.__sharingworker=!0,this.setWorker(this._options.worker))}return s(e,[{key:"setWorker",value:function(e){return this._worker=e,this._worker.importScripts=this.importScripts,this._worker.define(this.__uuid+"::doInBackground",this.doInBackground.toString()),this._worker}},{key:"execute",value:function(){var e,r,t;if(this.__hasExecuted&&!this.__keepAlive)throw new Error("Cannot execute a allready executed AsyncTask");return this._worker||this.setWorker(new c["default"]({})),this.__hasExecuted=!0,e=this._worker,r=f.call(arguments),t=e.run(this.__uuid+"::doInBackground",r),this.__keepAlive||this.__sharingworker||t.then(function(){e.terminate()})["catch"](function(){e.terminate()}),t}}]),e}();t["default"]=p},{"background-worker":2,uuid:7}]},{},[1])(1)});