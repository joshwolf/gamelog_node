var parseName=function(name){var salutations=["mr","master","mister","mrs","miss","ms","dr","prof","rev","fr","judge","honorable","hon"],suffixes=["i","ii","iii","iv","v","senior","junior","jr","sr","phd","apr","rph","pe","md","ma","dmd","cme"],compound=["vere","von","van","de","del","della","der","di","da","pietro","vanden","du","st.","st","la","lo","ter","bin","ibn","te","ten","op","ben"],parts=name.trim().split(/\s+/),attrs={};if(!parts.length)return attrs;1===parts.length&&(attrs.firstName=parts[0]),parts.length>1&&_.indexOf(suffixes,_.last(parts).toLowerCase().replace(/\./g,""))>-1&&(attrs.suffix=parts.pop(),parts[parts.length-1]=_.last(parts).replace(",",""));var firstNameFirstFormat=_.every(parts,function(part){return part.indexOf(",")===-1});if(firstNameFirstFormat){parts.length>1&&_.indexOf(salutations,_.first(parts).toLowerCase().replace(/\./g,""))>-1?(attrs.salutation=parts.shift(),attrs.firstName=parts.shift()):attrs.firstName=parts.shift(),attrs.lastName=parts.length?parts.pop():"";var revParts=parts.slice(0).reverse(),compoundParts=[];_.every(revParts,function(part,i,all){var test=part.toLowerCase().replace(/\./g,"");return _.indexOf(compound,test)>-1&&(compoundParts.push(part),!0)}),compoundParts.length&&(attrs.lastName=compoundParts.reverse().join(" ")+" "+attrs.lastName,parts=_.difference(parts,compoundParts)),parts.length&&(attrs.middleName=parts.join(" ")),attrs.lastName&&(attrs.lastName=attrs.lastName.replace(",","")),attrs.fullName=name}else{var firstNameIndex,lastName=_.reduce(parts,function(lastName,current,index){return Array.isArray(lastName)?current.indexOf(",")===-1?(lastName.push(current),lastName):(current=current.replace(",",""),lastName.push(current),firstNameIndex=index+1,lastName.join(" ")):lastName},[]);attrs.lastName=lastName;var remainingParts=parts.slice(firstNameIndex);remainingParts.length>1?(attrs.firstName=remainingParts.shift(),attrs.middleName=remainingParts.join(" ")):remainingParts.length&&(attrs.firstName=remainingParts[0]);var nameWords=[];attrs.firstName&&nameWords.push(attrs.firstName),attrs.middleName&&nameWords.push(attrs.middleName),nameWords.push(attrs.lastName),attrs.suffix&&nameWords.push(attrs.suffix),attrs.fullName=nameWords.join(" ")}return attrs};